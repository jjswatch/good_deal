<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>GoodDeal｜會員註冊</title>
<link rel="stylesheet" href="css/style.css" />
<style>
/* Hero */
.hero {
	background: #f7f7f7;
	padding: 24px 20px;
	text-align: center;
}

.hero h2 {
	margin: 0;
	font-size: 24px;
}

/* Main */
.main {
	max-width: 420px;
	margin: 60px auto;
	padding: 0 20px;
}

.main h2 {
	text-align: center;
	margin-bottom: 24px;
}

/* Form */
.form-group {
	margin-bottom: 16px;
}

.form-group label {
	display: block;
	margin-bottom: 6px;
	font-size: 14px;
	color: #555;
}

.form-group input {
	width: 100%;
	padding: 12px;
	border-radius: 10px;
	border: 1px solid #ddd;
	font-size: 15px;
	box-sizing: border-box;
}

.form-group input:focus {
	outline: none;
	border-color: #999;
}

/* Button */
button {
	width: 100%;
	padding: 14px;
	border-radius: 12px;
	border: none;
	background: #111;
	color: #fff;
	font-size: 16px;
	cursor: pointer;
}

button:hover {
	background: #333;
}

/* Extra */
.extra {
	text-align: center;
	margin-top: 16px;
	font-size: 14px;
	color: #777;
}

.extra a {
	color: #111;
	text-decoration: none;
	font-weight: bold;
}

.extra a:hover {
	text-decoration: underline;
}
</style>
</head>

<body>

<nav>
	<div class="nav-container">
		<div class="logo" onclick="location.href='index.html'">GoodDeal</div>
	</div>
</nav>

<section class="hero">
	<h2>會員註冊</h2>
</section>

<main class="main">
	<div class="form-group">
		<label>使用者名稱</label>
		<input id="username" placeholder="請輸入名稱">
	</div>

	<div class="form-group">
		<label>Email</label>
		<input id="email" type="email" placeholder="example@email.com">
	</div>
	
	<div class="form-group">
		<label>密碼</label>
		<input id="password" type="password" placeholder="至少 6 碼">
	</div>
	
	<div id="registerError" style="display:none; margin-bottom:12px; padding:10px; border-radius:10px; background:#fdecea; color:#b71c1c; font-size:14px; text-align:center;"></div>

	<button onclick="register()">註冊</button>

	<div class="extra">
		已有帳號？<a href="login.html">前往登入</a>
	</div>
</main>

<script src="js/api.js"></script>
<script>
async function register() {
	const username = document.getElementById("username").value.trim();
	const email = document.getElementById("email").value.trim();
	const passwordHash = document.getElementById("password").value;
	const errorBox = document.getElementById("registerError");

	errorBox.style.display = "none";
	errorBox.textContent = "";

	if (!username || !email || !passwordHash) { 
		errorBox.textContent = "請填寫所有欄位"; 
		errorBox.style.display = "block"; 
		return; 
	}

	try {
		const res = await fetch("/api/auth/register", { 
			method: "POST", 
			headers: { "Content-Type": "application/json" }, 
			body: JSON.stringify({ username, email, passwordHash }) 
		});

		if (!res.ok) {
			const errData = await res.json(); 
			errorBox.textContent = errData.error || "註冊失敗"; 
			errorBox.style.display = "block"; 
			return; 
		}

		const data = await res.json(); 
		alert(data.message || "註冊成功，請登入"); 
		location.href = "login.html";
	} catch (e) {
		errorBox.textContent = "系統錯誤，請稍後再試"; 
		errorBox.style.display = "block";
	}
}
</script>

</body>
</html>
