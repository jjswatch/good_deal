<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>一塊省｜登入</title>
<link rel="stylesheet" href="css/style.css" />
<style>
/* Hero */
.hero {
	background: #f7f7f7;
	padding: 24px 20px;
	text-align: center;
}

.hero h2 {
	margin: 0;
	font-size: 24px;
}

/* Main */
.main {
	max-width: 420px;
	margin: 60px auto;
	padding: 0 20px;
}

.main h2 {
	text-align: center;
	margin-bottom: 24px;
}

/* Form */
.form-group {
	margin-bottom: 16px;
}

.form-group label {
	display: block;
	margin-bottom: 6px;
	font-size: 14px;
	color: #555;
}

.form-group input {
	width: 100%;
	padding: 12px;
	border-radius: 10px;
	border: 1px solid #ddd;
	font-size: 15px;
	box-sizing: border-box;
}

.form-group input:focus {
	outline: none;
	border-color: #999;
}

/* Button */
button {
	width: 100%;
	padding: 14px;
	border-radius: 12px;
	border: none;
	background: #111;
	color: #fff;
	font-size: 16px;
	cursor: pointer;
}

button:hover {
	background: #333;
}

/* Extra */
.extra {
	text-align: center;
	margin-top: 16px;
	font-size: 14px;
	color: #777;
}

.extra a {
	color: #111;
	text-decoration: none;
	font-weight: bold;
}

.extra a:hover {
	text-decoration: underline;
}
</style>
</head>
<body>
<nav>
	<div class="nav-container">
		<div class="logo" onclick="location.href='index.html'">一塊省</div>
	</div>
</nav>

<section class="hero">
	<h2>會員登入</h2>
</section>

<main class="main">
	<div class="form-group">
		<label for="username">帳號</label> <input type="text" id="username" placeholder="請輸入帳號">
	</div>

	<div class="form-group">
		<label for="password">密碼</label> <input type="password" id="password" placeholder="請輸入密碼">
	</div>

	<div id="loginError" style="display: none; margin-bottom: 12px; padding: 10px; border-radius: 10px; background: #fdecea; color: #b71c1c; font-size: 14px; text-align: center;"></div>

	<button onclick="login()">登入</button>

	<div class="extra">還沒有帳號？ <a href="register.html">立即註冊</a></div>
</main>

<script src="js/api.js"></script>
<script>
async function login() {
	const username = document.getElementById("username").value.trim();
	const password = document.getElementById("password").value.trim();
	const errorBox = document.getElementById("loginError");

	errorBox.style.display = "none";
	errorBox.textContent = "";

	if (!username || !password) {
		errorBox.textContent = "請輸入帳號與密碼";
		errorBox.style.display = "block";
	    return;
	}

	try {
		const res = await fetch("/api/auth/login", {
			method: "POST",
			headers: { "Content-Type": "application/json" },
			body: JSON.stringify({ username, password })
		});

		if (!res.ok) {
			const errData = await res.json();
			errorBox.textContent = errData.error || "登入失敗";
			errorBox.style.display = "block";
			return;
		}

		const data = await res.json();

		localStorage.setItem("token", data.token);
		localStorage.setItem("role", data.user.role);
		localStorage.setItem("username", data.user.username);

		if (data.user.role === "ADMIN") {
			location.href = "admin/admin-dashboard.html";
		} else {
			location.href = "index.html";
		}
	} catch (err) {
		errorBox.textContent = "系統錯誤，請稍後再試";
		errorBox.style.display = "block";
	}
}
</script>
</body>
</html>
